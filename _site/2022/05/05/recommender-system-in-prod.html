<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>You want to build a Recommender System in Prod | AS3R Lab</title><meta name="description" content="a minimal, text focused blog theme"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/favicon.ico" type="image/x-icon"><link href='/feed.xml' rel='alternate' type='application/atom+xml'><link rel="canonical" href="/2022/05/05/recommender-system-in-prod.html"><link rel="stylesheet" href="/assets/style.css"><body><main><h2 class="title">AS3R Lab</h2><nav> <a href="http://0.0.0.0:4000">Home</a> <!-- <a href="http://0.0.0.0:4000">Blog</a> --> <a href="http://0.0.0.0:4000/publication">Publication</a> <a href="http://0.0.0.0:4000/events">Event</a></nav><h1>You want to build a Recommender System in Prod</h1><i>May 05, 2022</i><h4 class="subtitle">(You haven’t done that before)</h4><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; be you
&gt; have participated in kaggle recommender system competitions
&gt; datascientist.mp3
&gt; bossman says to recommend stuff for noobs
&gt; because they can’t search properly or whatever
&gt; ok bossman
&gt; no defined problem statement? 
&gt; no csv? 
&gt; no accuracy and mae test suite? 
&gt; no leaderboard?

what do /b/?
</code></pre></div></div><p><em>Haha, noob. Ok let’s do this.</em></p><hr /><h3 id="-frame-problem-statement">&gt; Frame problem statement</h3><p>You are an adult now. Frame the problem statement yourself. Just ask a bunch of questions and keep reducing scope. If you can visualise the mathematical formulation you have arrived. </p><p>Congratulations. Wasn’t so hard, was it.</p><h3 id="-build-framework">&gt; Build framework</h3><p>Setup your Jupyter Notebook so you can iterate fast. Build a first model, maybe a random model that spits out random predictions. Is this a good baseline? Don’t ask such stupid questions, it isn’t. But this will help you build an end to end training and testing pipeline. The train-test split, pre-process placeholders, test suite. </p><p>Build now so you don’t need to keep building later. </p><h3 id="-establish-baseline">&gt; Establish baseline</h3><p>You have the problem statement yeah? There is gotta be some stupid simple stuff that is better than random predictions. Yes, heuristics. Pick one, or some. Get test results. Now this is the one to beat. </p><h3 id="-metrics-and-reward-function">&gt; Metrics and reward function</h3><p>The very next thing is to establish a good metric of evaluation. Actually this should be the second point of order. But we are here, better late than later I guess.</p><p>This is going to be your leaderboard basically. And it should correlate <em>highly</em> with whatever problem statement you are solving for. Take some time here. </p><p>At least 2 hours. Minimum.</p><h3 id="-simple-algorithms-first">&gt; Simple algorithms first</h3><p>Or SAF for short. Heard of Multi Armed Bandits? Try that first. Shit’s amazing. Probably all that you’ll need.</p><hr /><p><em>With me so far?</em> </p><p><em>All this was within Jupyter. But predictions happen in the world outside, so we got stuff to do. Strap in. We are going outside.</em></p><hr /><h3 id="-prediction-service-setup">&gt; Prediction Service setup</h3><p>How you gonna do the predictions huh? You need an API or some shit. Setup a dummy service that takes in request (a user id maybe) and responds with predictions. </p><p>Find something that works with python scripts. Why? Because it is easy to convert a Jupyter Notebook to an executable script but what do I know, write in Cython for all I care. </p><p>But code well. Classes and shit. You are in production environment now. Act like it.</p><h3 id="-feature-store-low-latency-cache">&gt; Feature store (low latency cache)</h3><p>A lot of concurrent requests (QPS) and low latency requests means optimisations. Use caches and feature stores to save model weights and intermediate products. CosmosDB, Aerospike, just pick one and run with it. You know how dictionary look-ups are very fast? Same concept. Prefer lookups to on-demand processing.</p><p>Keep the actual prediction service is as light as possible. Maybe it just does a dot product of vectors. Maybe you found out about ONNX runtimes and used that. </p><p>Good job!</p><h3 id="-logs-health-metrics-and-alerting">&gt; Logs, health metrics and alerting</h3><p>Stuff breaks. Production stuff breaks hard. You need to know when it breaks. Log stuff. Model health, pre-processing data health, maybe every request and response (RRLogs). Actually, definitely do that. ELK, Kibana, or some such crap. Then setup alerts on it. So when a bunch of predictions are throwing NULLs you will be on top of it in 1 hour rather than the product folks telling you about it after 3 days.</p><p>While you are at it also set up some alerting on the infrastructure. Running at 95% memory capacity or 5% CPU capacity, both are bad. Or your Celery queue is choked to the end of times. Bad.</p><p>Keep your eyes on those numbers. Better, push those numbers (Prometheus) to a dashboard (Grafana) and set up alerts (PagerDuty). </p><p>Rest those eyes until needed.</p><h3 id="-performance-metrics">&gt; Performance metrics</h3><p>Fancy graphs that product people see to judge how good your recommender system is working. Should contain your model performance metrics and related product metrics (Retention, Engagement, Churn, what have you). Dunno what to use? Use Metabase. If someone asks why just say I told you to.</p><p>If you build this to be sufficiently standalone so all your future models can plug into it, well done, you are a good engineer.</p><h3 id="-model-re-training-and-pipelines">&gt; Model re-training and pipelines</h3><p>Models get stale. Underlying data may no longer be relevant. You gotta re-train your models. Automate that shit. </p><p>Airflow will let you schedule tasks and dependencies in what it calls DAGs. Which are just Graphs which have a particular Direction and are Acyclic. Use them. It is fancy cron and you can do some fancy cron stuff with it.</p><hr /><p><em>Congratulations. Your recommender system is now in production.</em> </p><p><em>Soon “people” will come to you with suggestions and ideas on how to make recommendations better. They will say it is a small change, let us see how it performs.</em></p><p><em>Now you are thinking about an experimentation framework. Hypothesis testing. Model Controller.</em></p><p><em>Until then…</em></p></main><footer> <a href="/blog">← Back to all writings</a> <!--<nav class="sans"><hr> <input class="menu-btn" type="checkbox" id="menu-btn" /><p><label class="menu-icon" for="menu-btn">Menu</label></p><ul class="site-nav"><li><a href="/">Home</a><li><a href="/blog">Blog</a><li><a href="/designs">Designs</a><li><a href="/about">About</a><li><a href="https://canisee.xyz" title="Confirm your vision functionality">[Can I See]</a></ul></nav>--> <!-- <span class="mini-note">You've reached the end of the page. Good job!</span> --> <!--<nav class="sans"><hr><p><label class="menu-icon" for="menu-btn">Menu</label></p><ul class="site-nav"><li><a href="/">Home</a><li><a href="/blog">Blog</a><li><a href="/designs">Designs</a><li><a href="/about">About</a><li><a href="https://canisee.xyz" title="Confirm your vision functionality">[Can I See]</a></ul></nav>--><div class="bottom-footer"> <i>Theme <a href="https://knhash.in/jekyllBear" title="the art">jekyllBear</a> built and maintained by <a href="https://knhash.in" title="the artist">knhash</a> </i></div></footer><!-- <script type="text/x-mathjax-config"> MathJax.Hub.Config({ extensions: ["tex2jax.js", "TeX/AMSmath.js"], jax: ["input/TeX", "output/SVG"], }) </script> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=default"> </script> -->
